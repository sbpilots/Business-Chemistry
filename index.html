<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat with Custom Assistant</title>
</head>
<body>
    <h1>Chat with Your Custom Assistant</h1>

    <div>
        <label for="userInput">Ask your question:</label>
        <input type="text" id="userInput" placeholder="Type your question here">
        <button onclick="startConversation()">Submit</button>
    </div>

    <div id="responseOutput"></div>

    <script>
        const apiKey = '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'; // Replace with your OpenAI API key
        let assistantId = 'asst_olXVByEhdTCdHFmPHnlSodVI'; // Your custom assistant ID
        let threadId = null; // This will store the thread ID

        // Step 1: Create a thread to start the conversation
        async function createThread() {
            console.log('Creating thread...'); // Log step
            const response = await fetch('https://api.openai.com/v1/threads', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`,
                    'OpenAI-Beta': 'assistants=v1'
                },
                body: JSON.stringify({ assistant_id: assistantId })
            });
            const data = await response.json();
            console.log('Thread created:', data); // Log thread creation
            threadId = data.id; // Save the thread ID
            return threadId;
        }

        // Step 2: Append a user message to the thread
        async function appendUserMessage(userInput) {
            console.log('Appending user message...'); // Log step
            const response = await fetch(`https://api.openai.com/v1/threads/${threadId}/messages`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`,
                    'OpenAI-Beta': 'assistants=v1'
                },
                body: JSON.stringify({
                    role: 'user',
                    content: userInput
                })
            });
            const data = await response.json();
            console.log('User message appended:', data); // Log success
            return data;
        }

        // Step 3: Create a run to get the assistant's response
        async function createRun() {
            console.log('Creating run...'); // Log step
            const response = await fetch(`https://api.openai.com/v1/threads/${threadId}/runs`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`,
                    'OpenAI-Beta': 'assistants=v1'
                },
                body: JSON.stringify({ assistant_id: assistantId })
            });
            const data = await response.json();
            console.log('Run created:', data); // Log success
            return data;
        }

        // Step 4: Get the AI response
        async function getAIResponse() {
            console.log('Fetching AI response...'); // Log step
            const response = await fetch(`https://api.openai.com/v1/threads/${threadId}/messages`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'OpenAI-Beta': 'assistants=v1'
                }
            });
            const data = await response.json();
            console.log('AI response fetched:', data); // Log AI response
            return data.messages[data.messages.length - 1].content; // Get the last message in the thread
        }

        // Full conversation flow: Create thread, append message, create run, and get response
        async function startConversation() {
            const userInput = document.getElementById('userInput').value;
            const responseOutput = document.getElementById('responseOutput');
            console.log('User input:', userInput); // Log user input

            try {
                if (!threadId) {
                    await createThread(); // Create a new thread if one doesn't exist
                }
                await appendUserMessage(userInput); // Append user message
                await createRun(); // Create a run to process the message
                const assistantResponse = await getAIResponse(); // Fetch assistant's response

                console.log('Assistant response:', assistantResponse); // Log assistant response
                responseOutput.innerText = assistantResponse;
            } catch (error) {
                console.error('Error during conversation flow:', error); // Log error
                responseOutput.innerText = `Error: ${error.message}`;
            }
        }
    </script>

</body>
</html>
